<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Chi Ti·∫øt Sinh Vi√™n</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <nav class="navbar navbar-dark bg-primary">
        <div class="container">
            <span class="navbar-brand mb-0 h1">üéì Chi Ti·∫øt Sinh Vi√™n</span>
            <a href="/" class="btn btn-light">‚Üê Quay l·∫°i</a>
        </div>
    </nav>

    <div class="container mt-5">
        <div id="loading" class="text-center">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">ƒêang t·∫£i...</span>
            </div>
        </div>

        <div id="studentDetail" style="display: none;">
            <h2>Th√¥ng Tin Chi Ti·∫øt Sinh Vi√™n</h2>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">Th√¥ng Tin C∆° B·∫£n</h5>
                        </div>
                        <div class="card-body">
                            <table class="table table-borderless">
                                <tr>
                                    <td><strong>M√£ sinh vi√™n:</strong></td>
                                    <td id="masv"></td>
                                </tr>
                                <tr>
                                    <td><strong>H·ªç t√™n:</strong></td>
                                    <td id="hoten"></td>
                                </tr>
                                <tr>
                                    <td><strong>L·ªõp:</strong></td>
                                    <td id="lop"></td>
                                </tr>
                                <tr>
                                    <td><strong>Khoa:</strong></td>
                                    <td id="khoa"></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-warning text-dark">
                            <h5 class="mb-0">K·∫øt Qu·∫£ D·ª± ƒêo√°n</h5>
                        </div>
                        <div class="card-body">
                            <table class="table table-borderless">
                                <tr>
                                    <td><strong>ƒêi·ªÉm trung b√¨nh:</strong></td>
                                    <td id="diem_tb"></td>
                                </tr>
                                <tr>
                                    <td><strong>S·ªë t√≠n ch·ªâ r·ªõt:</strong></td>
                                    <td id="tin_chi_rot"></td>
                                </tr>
                                <tr>
                                    <td><strong>S·ªë m√¥n h·ªçc l·∫°i:</strong></td>
                                    <td id="so_mon_hoc_lai"></td>
                                </tr>
                                <tr>
                                    <td><strong>T·ª∑ l·ªá b·ªè h·ªçc:</strong></td>
                                    <td id="ty_le_bo_hoc_so"></td>
                                </tr>
                                <tr>
                                    <td><strong>ƒê√°nh gi√°:</strong></td>
                                    <td id="ty_le_bo_hoc_chu"></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0">Th√¥ng Tin ƒê·∫ßy ƒê·ªß T·ª´ Excel</h5>
                        </div>
                        <div class="card-body">
                            <div id="fullDetails" class="table-responsive">
                                <!-- D·ªØ li·ªáu ƒë·∫ßy ƒë·ªß s·∫Ω ƒë∆∞·ª£c load ƒë·ªông -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="error" class="alert alert-danger" style="display: none;">
            <strong>L·ªói:</strong> <span id="errorMessage"></span>
        </div>
    </div>

    <footer class="bg-light text-center py-3 mt-5">
        <p class="mb-0">&copy; 2024 H·ªá Th·ªëng D·ª± ƒêo√°n Sinh Vi√™n B·ªè H·ªçc</p>
    </footer>

    <script>
     // L·∫•y m√£ sinh vi√™n t·ª´ URL
function getStudentIdFromUrl() {
    const path = window.location.pathname;
    const parts = path.split('/');
    return parts[parts.length - 1];
}
// Load th√¥ng tin sinh vi√™n
async function loadStudentDetail() {
    const masv = getStudentIdFromUrl();
    
    try {
        const response = await fetch(`/api/student/${masv}`); // G·ªçi API ƒë·ªÉ l·∫•y d·ªØ li·ªáu
        const data = await response.json();
        
        if (data.error) {
            showError(data.error);
            return;
        }
        
        displayStudentDetail(data);
        
    } catch (error) {
        showError('Kh√¥ng th·ªÉ t·∫£i th√¥ng tin sinh vi√™n: ' + error.message);
    }
}

        // Hi·ªÉn th·ªã th√¥ng tin sinh vi√™n
        function displayStudentDetail(student) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('studentDetail').style.display = 'block';

            // Hi·ªÉn th·ªã th√¥ng tin c∆° b·∫£n
            document.getElementById('masv').textContent = student.masv || 'Kh√¥ng c√≥';
            document.getElementById('hoten').textContent = student.hoten || 'Kh√¥ng c√≥';
            document.getElementById('lop').textContent = student.lop || 'Kh√¥ng c√≥';
            document.getElementById('khoa').textContent = student.khoa || 'Kh√¥ng c√≥';
            
            // Hi·ªÉn th·ªã k·∫øt qu·∫£ d·ª± ƒëo√°n
            document.getElementById('diem_tb').textContent = student.diem_tb || 0;
            document.getElementById('tin_chi_rot').textContent = student.tin_chi_rot || 0;
            document.getElementById('so_mon_hoc_lai').textContent = student.so_mon_hoc_lai || 0;
            document.getElementById('ty_le_bo_hoc_so').textContent = student.ty_le_bo_hoc_so || '0%';
            
            const danhGia = document.getElementById('ty_le_bo_hoc_chu');
            danhGia.textContent = student.ty_le_bo_hoc_chu || 'Kh√¥ng x√°c ƒë·ªãnh';
            danhGia.className = student.prediction === 1 ? 'text-danger fw-bold' : 'text-success fw-bold';

            // Hi·ªÉn th·ªã th√¥ng tin ƒë·∫ßy ƒë·ªß t·ª´ Excel
            displayFullDetails(student);
        }

        // Hi·ªÉn th·ªã t·∫•t c·∫£ th√¥ng tin t·ª´ Excel
        function displayFullDetails(student) {
            const fullDetails = document.getElementById('fullDetails');
            let html = '<table class="table table-striped">';
            html += '<thead><tr><th>Tr∆∞·ªùng d·ªØ li·ªáu</th><th>Gi√° tr·ªã</th></tr></thead><tbody>';
            
            // S·∫Øp x·∫øp v√† hi·ªÉn th·ªã t·∫•t c·∫£ c√°c tr∆∞·ªùng
            const sortedKeys = Object.keys(student).sort();
            sortedKeys.forEach(key => {
                if (key !== 'prediction' && key !== 'dropout_probability') {
                    const value = student[key];
                    if (value !== null && value !== undefined && value !== '') {
                        html += `<tr>
                            <td><strong>${key.replace(/_/g, ' ').toUpperCase()}</strong></td>
                            <td>${value}</td>
                        </tr>`;
                    }
                }
            });
            
            html += '</tbody></table>';
            fullDetails.innerHTML = html;
        }

        // Hi·ªÉn th·ªã l·ªói
        function showError(message) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'block';
            document.getElementById('errorMessage').textContent = message;
        }

        // Load d·ªØ li·ªáu khi trang ƒë∆∞·ª£c t·∫£i
        document.addEventListener('DOMContentLoaded', loadStudentDetail);
    </script>
</body>
</html>
